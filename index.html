<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solvo Global Dashboard</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        solvo: { orange: '#F36F21', navy: '#002F5D' },
                        apple: {
                            gray: '#F5F5F7', 
                            card: '#FFFFFF', 
                            border: 'rgba(0, 0, 0, 0.06)',
                            text: '#1D1D1F', 
                            subtext: '#86868B', 
                            blue: '#0071E3',
                            red: '#FF3B30', 
                            green: '#34C759', 
                            orange: '#FF9500',
                        },
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    boxShadow: {
                        'apple-card': '0 4px 24px 0 rgba(0, 0, 0, 0.04)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F5F5F7;
            color: #1D1D1F;
        }
        
        /* Glassmorphism Header */
        header {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0,0,0,0.06);
        }

        /* Scrollbar hiding for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Chart container tweaks */
        canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <header class="sticky top-0 z-50 px-6 py-4 flex items-center justify-between shadow-sm transition-all duration-300">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-solvo-orange rounded-lg flex items-center justify-center text-white font-bold text-lg">S</div>
            <span class="font-semibold text-lg tracking-tight text-solvo-navy">Solvo Global</span>
        </div>

        <div class="absolute left-1/2 transform -translate-x-1/2 bg-gray-200/50 p-1 rounded-full flex text-sm font-medium backdrop-blur-md">
            <button onclick="switchTab('recruitment')" id="tab-recruitment" class="px-6 py-1.5 rounded-full transition-all duration-200 shadow-sm bg-white text-apple-text">Recruitment</button>
            <button onclick="switchTab('scheduling')" id="tab-scheduling" class="px-6 py-1.5 rounded-full transition-all duration-200 text-apple-subtext hover:text-apple-text">Scheduling</button>
        </div>

        <div class="flex items-center gap-4 text-apple-subtext">
            <button class="hover:text-solvo-orange transition-colors"><i data-lucide="search" class="w-5 h-5"></i></button>
            <button class="relative hover:text-solvo-orange transition-colors">
                <i data-lucide="bell" class="w-5 h-5"></i>
                <span class="absolute top-0 right-0 w-2 h-2 bg-apple-red rounded-full border-2 border-white"></span>
            </button>
            <div class="w-8 h-8 bg-gray-200 rounded-full overflow-hidden border border-apple-border">
                <img src="https://ui-avatars.com/api/?name=Admin+User&background=0D8ABC&color=fff" alt="User">
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full p-6 space-y-6" id="app">
        </main>

    <script>
        // ---------------------------------------------------------
        // 3. Data Structure (Exact JSON provided)
        // ---------------------------------------------------------
        const dashboardData = {
          "recruitment": {
            "summary_kpis": {
              "review_rate": { "value": "92%", "subValue": "Applicants Processed", "target": "90%", "trend": "up" },
              "interview_pass_rate": { "value": "96%", "subValue": "Offer / Interview", "target": "75%", "trend": "up" },
              "offer_acceptance_rate": { "value": "35%", "subValue": "Signed / Offered", "target": "50%", "trend": "neutral" }
            },
            "original_stats": {
              "unreviewed_applicants": { "value": "31", "subValue": "Action Required" },
              "interviews_scheduled": { "value": "8", "subValue": "By Mariana ArÃ©valo" },
              "pending_onboarding": { "value": "9", "subValue": "Documents Signed" },
              "avg_response_time": { "value": "24h", "subValue": "Caregiver Role" }
            },
            "performance_goals": [
              { "label": "Interviews", "current": 8, "target": 15, "unit": "", "status": "behind" },
              { "label": "Onboarding", "current": 9, "target": 5, "unit": "", "status": "on-track" },
              { "label": "Response Time", "current": 24, "target": 12, "unit": "h", "status": "behind", "reverse": true }
            ],
            "ai_insights": [
              { "type": "success", "text": "Interview Pass Rate is exceptional (96%). Candidate quality is currently high." },
              { "type": "warning", "text": "Offer Acceptance (35%) is below target. Review competitive compensation." },
              { "type": "info", "text": "Caregiver role has the highest volume but slowest response time (24h)." }
            ],
            "funnel": [
              { "step": "Applicants", "value": 48 },
              { "step": "Interviews", "value": 27 }, 
              { "step": "Offers", "value": 26 }, 
              { "step": "Hires", "value": 0 }
            ],
            "weekly_trends": [
              { "date": "09/28", "applications": 2 },
              { "date": "10/05", "applications": 10 },
              { "date": "10/12", "applications": 5 },
              { "date": "10/19", "applications": 7 },
              { "date": "10/26", "applications": 10 },
              { "date": "11/02", "applications": 6 },
              { "date": "11/09", "applications": 3 },
              { "date": "11/16", "applications": 1 },
              { "date": "11/23", "applications": 2 },
              { "date": "11/30", "applications": 1 }
            ],
            "status_breakdown": [
              { "status": "Sent Documents", "count": 12 },
              { "status": "Docs Signed", "count": 9 },
              { "status": "Contact Attempted", "count": 7 },
              { "status": "In Communication", "count": 7 },
              { "status": "New", "count": 4 },
              { "status": "Interview Set", "count": 2 },
              { "status": "3rd Contact", "count": 2 },
              { "status": "Other", "count": 4 }
            ],
            "role_efficiency": {
              "breakdown": [
                { "role": "Caregiver", "hours": 24.0, "applicants": 24, "emails": 59, "texts": 53 },
                { "role": "Backup Childcare Provider", "hours": 617.4, "applicants": 46, "emails": 10, "texts": 60 }
              ],
              "total": { "role": "Total", "hours": 419.6, "applicants": 70, "emails": 69, "texts": 113 }
            }
          },
          "scheduling": {
            "summary_kpis": {
              "clock_compliance": { "value": "66%", "subValue": "Verified Events", "target": "95%", "trend": "down" },
              "modification_rate": { "value": "29%", "subValue": "Schedule Changes", "target": "15%", "trend": "up" },
              "service_distribution": { "value": "70%", "subValue": "Personal Care Mix", "trend": "neutral" }
            },
            "original_stats": {
              "total_shifts": { "value": "486", "subValue": "Q4 2025" },
              "schedule_modifications": { "value": "142", "subValue": "Shift Updates" },
              "billable_hours": { "value": "3,240", "subValue": "Hours Verified" },
              "avg_hours_per_shift": { "value": "6.7h", "subValue": "Avg Duration"} 
            },
            "performance_goals": [
               { "label": "Billable Hours", "current": 3240, "target": 3000, "unit": "h", "status": "on-track" },
               { "label": "Total Shifts", "current": 486, "target": 450, "unit": "", "status": "on-track" },
               { "label": "Missed Clocks", "current": 166, "target": 50, "unit": "", "status": "behind", "reverse": true }
            ],
            "ai_insights": [
              { "type": "danger", "text": "Critical: 110 'Missed Both' clock events detected. Compliance risk is elevated." },
              { "type": "success", "text": "Billable hours are trending up (+12% vs last month)." },
              { "type": "info", "text": "Personal Care accounts for 70% of all scheduled shifts." }
            ],
            "service_mix": [
              { "status": "Personal Care", "count": 340 },
              { "status": "Backup Care", "count": 95 },
              { "status": "Transportation", "count": 35 },
              { "status": "Training", "count": 16 }
            ],
            "clock_compliance_breakdown": [
              { "status": "Verified", "count": 320 },
              { "status": "Missed Both", "count": 110 },
              { "status": "Missed Out", "count": 32 },
              { "status": "Missed In", "count": 24 }
            ],
            "activity_log": [
              { "date": "11/28", "action": "Create profile", "detail": "MOERSCHELL, ADAM" },
              { "date": "11/26", "action": "Create profile", "detail": "De Leon, Brenda" },
              { "date": "11/24", "action": "Update profile", "detail": "Transport, Marlon" }
            ]
          }
        };

        // Fix for inconsistent data structure in original_stats (avg_hours_per_shift was string, others obj)
        if(typeof dashboardData.scheduling.original_stats.avg_hours_per_shift === 'string') {
            dashboardData.scheduling.original_stats.avg_hours_per_shift = {
                value: dashboardData.scheduling.original_stats.avg_hours_per_shift,
                subValue: "Shift Average"
            };
        }

        // ---------------------------------------------------------
        // State & Utilities
        // ---------------------------------------------------------
        let activeTab = 'recruitment';
        const app = document.getElementById('app');
        let chartInstances = [];

        function switchTab(tab) {
            activeTab = tab;
            
            // Update UI Tabs
            const tabs = ['recruitment', 'scheduling'];
            tabs.forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                if (t === activeTab) {
                    el.classList.remove('text-apple-subtext', 'bg-transparent');
                    el.classList.add('bg-white', 'text-apple-text', 'shadow-sm');
                } else {
                    el.classList.add('text-apple-subtext', 'bg-transparent');
                    el.classList.remove('bg-white', 'text-apple-text', 'shadow-sm');
                }
            });

            renderDashboard();
        }

        function getTrendIcon(trend) {
            if (trend === 'up') return `<span class="bg-apple-green/10 text-apple-green p-1 rounded-full"><i data-lucide="trending-up" class="w-4 h-4"></i></span>`;
            if (trend === 'down') return `<span class="bg-apple-red/10 text-apple-red p-1 rounded-full"><i data-lucide="trending-down" class="w-4 h-4"></i></span>`;
            return `<span class="bg-apple-gray text-apple-subtext p-1 rounded-full"><i data-lucide="minus" class="w-4 h-4"></i></span>`;
        }

        function getInsightColor(type) {
            if (type === 'success') return 'bg-apple-green/10 text-apple-green border-apple-green/20';
            if (type === 'danger' || type === 'warning') return 'bg-apple-red/10 text-apple-red border-apple-red/20';
            return 'bg-apple-blue/10 text-apple-blue border-apple-blue/20';
        }

        function getInsightIcon(type) {
             if (type === 'success') return 'check-circle-2';
             if (type === 'danger' || type === 'warning') return 'alert-circle';
             return 'info';
        }

        function calculateRing(current, target, reverse = false) {
            const percent = Math.min((current / target) * 100, 100);
            const circumference = 2 * Math.PI * 18; // r=18
            const offset = circumference - (percent / 100) * circumference;
            let color = 'text-apple-blue';
            
            // Logic for status color
            if (!reverse) {
                if (percent >= 100) color = 'text-apple-green';
                else if (percent >= 70) color = 'text-apple-orange';
                else color = 'text-apple-red';
            } else {
                 if (current > target) color = 'text-apple-red';
                 else color = 'text-apple-green';
            }

            return { offset, color, percent: Math.round(percent) };
        }

        // ---------------------------------------------------------
        // Rendering
        // ---------------------------------------------------------
        function renderDashboard() {
            // Destroy existing charts
            chartInstances.forEach(c => c.destroy());
            chartInstances = [];

            const data = dashboardData[activeTab];

            // 1. KPI Cards HTML
            const kpiHTML = Object.entries(data.summary_kpis).map(([key, item]) => `
                <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border flex flex-col justify-between h-full">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-sm font-medium text-apple-subtext uppercase tracking-wider">${key.replace(/_/g, ' ')}</span>
                        ${getTrendIcon(item.trend)}
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-apple-text tracking-tight mb-1">${item.value}</div>
                        <div class="text-sm text-apple-subtext">${item.subValue}</div>
                        ${item.target ? `<div class="text-xs text-apple-subtext mt-2 font-medium">Target: ${item.target}</div>` : ''}
                    </div>
                </div>
            `).join('');

            // 2. Original Stats (Bento Grid)
            const statsHTML = Object.entries(data.original_stats).map(([key, item]) => `
                <div class="bg-white rounded-2xl p-5 shadow-apple-card border border-apple-border flex items-center justify-between">
                    <div>
                        <div class="text-2xl font-bold text-solvo-navy mb-0.5">${item.value}</div>
                        <div class="text-xs text-apple-subtext font-medium truncate">${item.subValue}</div>
                    </div>
                    <div class="h-8 w-8 rounded-full bg-apple-gray flex items-center justify-center text-apple-text">
                        <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
                    </div>
                </div>
            `).join('');

            // 3. Main Content Columns
            let mainLeftHTML = '';
            
            if (activeTab === 'recruitment') {
                mainLeftHTML = `
                    <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border mb-6">
                        <h3 class="text-lg font-semibold text-apple-text mb-4">Application Volume (Weekly)</h3>
                        <div class="h-64 relative">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border">
                            <h3 class="text-lg font-semibold text-apple-text mb-4">Hiring Funnel</h3>
                            <div class="h-48 relative">
                                <canvas id="funnelChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border">
                            <h3 class="text-lg font-semibold text-apple-text mb-4">Status Breakdown</h3>
                            <div class="h-48 relative">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-apple-card border border-apple-border overflow-hidden">
                        <div class="p-6 border-b border-apple-border">
                            <h3 class="text-lg font-semibold text-apple-text">Role Efficiency</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-apple-gray text-xs text-apple-subtext uppercase font-semibold">
                                    <tr>
                                        <th class="p-4">Role</th>
                                        <th class="p-4">Hours</th>
                                        <th class="p-4">Applicants</th>
                                        <th class="p-4">Emails</th>
                                        <th class="p-4">Texts</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-apple-border text-sm text-apple-text">
                                    ${data.role_efficiency.breakdown.map(r => `
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="p-4 font-medium">${r.role}</td>
                                            <td class="p-4 text-apple-subtext">${r.hours}</td>
                                            <td class="p-4">${r.applicants}</td>
                                            <td class="p-4">${r.emails}</td>
                                            <td class="p-4">${r.texts}</td>
                                        </tr>
                                    `).join('')}
                                    <tr class="bg-gray-50 font-semibold">
                                        <td class="p-4 text-solvo-navy">Total</td>
                                        <td class="p-4 text-solvo-orange">${data.role_efficiency.total.hours}</td>
                                        <td class="p-4">${data.role_efficiency.total.applicants}</td>
                                        <td class="p-4">${data.role_efficiency.total.emails}</td>
                                        <td class="p-4">${data.role_efficiency.total.texts}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                // Scheduling Content
                mainLeftHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border">
                            <h3 class="text-lg font-semibold text-apple-text mb-4">Service Mix</h3>
                            <div class="h-64 relative">
                                <canvas id="serviceChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border">
                            <h3 class="text-lg font-semibold text-apple-text mb-4">Clock Compliance</h3>
                            <div class="h-64 relative">
                                <canvas id="complianceChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-apple-card border border-apple-border overflow-hidden">
                        <div class="p-6 border-b border-apple-border flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-apple-text">Recent Activity</h3>
                            <span class="text-xs bg-gray-100 text-apple-subtext px-2 py-1 rounded">Last 7 Days</span>
                        </div>
                        <div class="divide-y divide-apple-border">
                            ${data.activity_log.map(log => `
                                <div class="p-4 flex items-center justify-between hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-solvo-orange/10 text-solvo-orange flex items-center justify-center">
                                            <i data-lucide="activity" class="w-4 h-4"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-medium text-apple-text">${log.action}</div>
                                            <div class="text-xs text-apple-subtext">${log.detail}</div>
                                        </div>
                                    </div>
                                    <div class="text-xs text-apple-subtext font-mono">${log.date}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // 4. Sidebar HTML (Goals & AI)
            const goalsHTML = data.performance_goals.map(goal => {
                const ring = calculateRing(goal.current, goal.target, goal.reverse);
                return `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl mb-3">
                    <div>
                        <div class="text-sm font-semibold text-apple-text">${goal.label}</div>
                        <div class="text-xs text-apple-subtext">${goal.current} / ${goal.target} ${goal.unit}</div>
                    </div>
                    <div class="relative w-12 h-12">
                        <svg class="w-full h-full" viewBox="0 0 40 40">
                            <circle class="text-gray-200" stroke-width="3" stroke="currentColor" fill="transparent" r="18" cx="20" cy="20" />
                            <circle class="${ring.color} progress-ring__circle" stroke-width="3" stroke-dasharray="113" stroke-dashoffset="${ring.offset}" stroke-linecap="round" stroke="currentColor" fill="transparent" r="18" cx="20" cy="20" />
                        </svg>
                        <span class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-[10px] font-bold text-apple-text">${ring.percent}%</span>
                    </div>
                </div>`;
            }).join('');

            const insightsHTML = data.ai_insights.map(insight => `
                <div class="p-4 rounded-xl border mb-3 flex gap-3 ${getInsightColor(insight.type)}">
                    <i data-lucide="${getInsightIcon(insight.type)}" class="w-5 h-5 flex-shrink-0 mt-0.5"></i>
                    <p class="text-sm font-medium leading-relaxed text-black/70">${insight.text}</p>
                </div>
            `).join('');


            // 5. Construct Full HTML
            app.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    ${kpiHTML}
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    ${statsHTML}
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <div class="lg:col-span-2">
                        ${mainLeftHTML}
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border">
                            <div class="flex items-center gap-2 mb-4">
                                <i data-lucide="target" class="w-5 h-5 text-solvo-orange"></i>
                                <h3 class="text-lg font-semibold text-apple-text">Goals</h3>
                            </div>
                            <div>${goalsHTML}</div>
                        </div>

                        <div class="bg-white rounded-2xl p-6 shadow-apple-card border border-apple-border">
                            <div class="flex items-center gap-2 mb-4">
                                <i data-lucide="sparkles" class="w-5 h-5 text-solvo-navy"></i>
                                <h3 class="text-lg font-semibold text-apple-text">Smart Insights</h3>
                            </div>
                            <div>${insightsHTML}</div>
                        </div>
                    </div>
                </div>
            `;

            // Initialize Icons
            lucide.createIcons();

            // Initialize Charts based on Tab
            initCharts(data);
        }

        function initCharts(data) {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { font: { family: 'Inter', size: 11 }, boxWidth: 10, usePointStyle: true } }
                }
            };

            if (activeTab === 'recruitment') {
                // 1. Weekly Trends (Area Chart)
                const ctxTrend = document.getElementById('trendChart').getContext('2d');
                chartInstances.push(new Chart(ctxTrend, {
                    type: 'line',
                    data: {
                        labels: data.weekly_trends.map(d => d.date),
                        datasets: [{
                            label: 'Applications',
                            data: data.weekly_trends.map(d => d.applications),
                            borderColor: '#F36F21',
                            backgroundColor: (context) => {
                                const ctx = context.chart.ctx;
                                const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                                gradient.addColorStop(0, 'rgba(243, 111, 33, 0.2)');
                                gradient.addColorStop(1, 'rgba(243, 111, 33, 0)');
                                return gradient;
                            },
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#F36F21',
                            pointRadius: 4
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: { y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.04)' } }, x: { grid: { display: false } } },
                        plugins: { legend: { display: false } }
                    }
                }));

                // 2. Funnel (Horizontal Bar)
                const ctxFunnel = document.getElementById('funnelChart').getContext('2d');
                chartInstances.push(new Chart(ctxFunnel, {
                    type: 'bar',
                    data: {
                        labels: data.funnel.map(d => d.step),
                        datasets: [{
                            label: 'Count',
                            data: data.funnel.map(d => d.value),
                            backgroundColor: ['#002F5D', '#0071E3', '#34C759', '#FF9500'],
                            borderRadius: 4,
                            barThickness: 20
                        }]
                    },
                    options: {
                        ...commonOptions,
                        indexAxis: 'y',
                        scales: { x: { display: false }, y: { grid: { display: false } } },
                        plugins: { legend: { display: false } }
                    }
                }));

                // 3. Status Breakdown (Donut)
                const ctxStatus = document.getElementById('statusChart').getContext('2d');
                chartInstances.push(new Chart(ctxStatus, {
                    type: 'doughnut',
                    data: {
                        labels: data.status_breakdown.map(d => d.status),
                        datasets: [{
                            data: data.status_breakdown.map(d => d.count),
                            backgroundColor: [
                                '#002F5D', '#F36F21', '#0071E3', '#34C759', 
                                '#FF3B30', '#FF9500', '#8E8E93', '#D1D1D6'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        ...commonOptions,
                        cutout: '70%',
                        plugins: { legend: { position: 'right', labels: { boxWidth: 10 } } }
                    }
                }));
            } else {
                // 1. Service Mix (Donut)
                const ctxService = document.getElementById('serviceChart').getContext('2d');
                chartInstances.push(new Chart(ctxService, {
                    type: 'doughnut',
                    data: {
                        labels: data.service_mix.map(d => d.status),
                        datasets: [{
                            data: data.service_mix.map(d => d.count),
                            backgroundColor: ['#002F5D', '#F36F21', '#34C759', '#FF9500'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        ...commonOptions,
                        cutout: '70%',
                        plugins: { legend: { position: 'right' } }
                    }
                }));

                // 2. Compliance (Bar)
                const ctxComp = document.getElementById('complianceChart').getContext('2d');
                chartInstances.push(new Chart(ctxComp, {
                    type: 'bar',
                    data: {
                        labels: data.clock_compliance_breakdown.map(d => d.status),
                        datasets: [{
                            label: 'Events',
                            data: data.clock_compliance_breakdown.map(d => d.count),
                            backgroundColor: ['#34C759', '#FF3B30', '#FF9500', '#0071E3'],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: { y: { beginAtZero: true }, x: { grid: { display: false } } },
                        plugins: { legend: { display: false } }
                    }
                }));
            }
        }

        // Initial Render
        renderDashboard();

    </script>
</body>
</html>
